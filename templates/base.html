<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Apple Touch Icons for iOS home screen -->
    <link rel="apple-touch-icon" href="{{ url_for('static', filename='apple-touch-icon.png') }}">
    <link rel="apple-touch-icon" sizes="180x180" href="{{ url_for('static', filename='apple-touch-icon-180x180.png') }}">
    <link rel="apple-touch-icon" sizes="152x152" href="{{ url_for('static', filename='apple-touch-icon-152x152.png') }}">
    <link rel="apple-touch-icon" sizes="120x120" href="{{ url_for('static', filename='apple-touch-icon-120x120.png') }}">
    <meta name="apple-mobile-web-app-title" content="Form Analyst">
    <title>{% block title %}The Form Analyst{% endblock %}</title>

    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <!-- Premium font -->
    <link href="https://fonts.googleapis.com/css2?family=DM+Mono:wght@300;400;500&family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <style>
        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           DESIGN TOKENS
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        :root {
            /* Brand */
            --accent:          #667eea;
            --accent-2:        #764ba2;
            --accent-glow:     rgba(102, 126, 234, 0.25);

            /* Surfaces */
            --bg-base:         #09090f;
            --bg-surface:      #111118;
            --bg-elevated:     #18181f;
            --bg-hover:        #1e1e28;

            /* Borders */
            --border-subtle:   rgba(255,255,255,0.06);
            --border-mid:      rgba(255,255,255,0.10);
            --border-accent:   rgba(102,126,234,0.35);

            /* Text */
            --text-primary:    #f0f0f5;
            --text-secondary:  #9090a8;
            --text-muted:      #55556a;

            /* Status */
            --success:         #10b981;
            --warning:         #f59e0b;
            --danger:          #ef4444;
            --info:            #3b82f6;

            /* Legacy Bootstrap overrides (keeps child templates working) */
            --primary-color:   #667eea;
            --secondary-color: #764ba2;
            --accent-color:    #667eea;
            --success-color:   #10b981;
            --warning-color:   #f59e0b;
            --danger-color:    #ef4444;
            --light-bg:        #18181f;
            --card-shadow:     0 2px 16px rgba(0,0,0,0.4);
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           BASE
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        *, *::before, *::after { box-sizing: border-box; }

        body {
            font-family: 'Outfit', system-ui, sans-serif;
            background: var(--bg-base);
            color: var(--text-primary);
            min-height: 100vh;
            padding-top: 68px;
            /* Subtle dot-grid texture */
            background-image: radial-gradient(
                circle,
                rgba(102,126,234,0.06) 1px,
                transparent 1px
            );
            background-size: 28px 28px;
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           SCROLLBAR
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: var(--bg-base); }
        ::-webkit-scrollbar-thumb {
            background: var(--border-mid);
            border-radius: 3px;
        }
        ::-webkit-scrollbar-thumb:hover { background: var(--accent); }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           NAVBAR
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .navbar {
            background: rgba(9, 9, 15, 0.92) !important;
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--border-subtle);
            padding: 0 !important;
            height: 68px;
            box-shadow: 0 1px 0 var(--border-subtle), 0 4px 24px rgba(0,0,0,0.3);
        }

        .navbar .container-fluid {
            height: 100%;
            padding: 0 1.5rem;
        }

        .navbar-brand {
            font-family: 'Outfit', sans-serif;
            font-weight: 700;
            font-size: 1.15rem !important;
            color: var(--text-primary) !important;
            letter-spacing: -0.01em;
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 0 !important;
        }

        /* Brand icon container */
        .navbar-brand .brand-icon {
            width: 32px;
            height: 32px;
            background: linear-gradient(135deg, var(--accent), var(--accent-2));
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            color: white;
            flex-shrink: 0;
            box-shadow: 0 2px 8px var(--accent-glow);
        }

        /* Keep existing bi icon on brand if present */
        .navbar-brand i {
            color: var(--accent);
        }

        /* Nav links */
        .nav-link {
            font-family: 'Outfit', sans-serif;
            font-size: 13px !important;
            font-weight: 500 !important;
            color: var(--text-secondary) !important;
            letter-spacing: 0.02em;
            padding: 6px 12px !important;
            margin: 0 2px !important;
            border-radius: 7px !important;
            transition: color 0.2s ease, background 0.2s ease !important;
            display: flex;
            align-items: center;
            gap: 6px;
            white-space: nowrap;
        }

        .nav-link i { font-size: 14px; }

        .nav-link:hover {
            color: var(--text-primary) !important;
            background: var(--bg-hover) !important;
            transform: none !important; /* remove the bounce from original */
        }

        .nav-link.active {
            color: var(--text-primary) !important;
            background: linear-gradient(135deg, rgba(102,126,234,0.18), rgba(118,75,162,0.12)) !important;
            border: 1px solid var(--border-accent) !important;
        }

        /* Username display pill */
        .navbar .nav-link.user-pill {
            color: var(--text-muted) !important;
            font-family: 'DM Mono', monospace;
            font-size: 12px !important;
            background: var(--bg-elevated) !important;
            border: 1px solid var(--border-subtle) !important;
            cursor: default;
        }

        /* Hamburger toggler */
        .navbar-toggler {
            border: 1px solid var(--border-mid) !important;
            padding: 6px 10px !important;
            border-radius: 8px !important;
        }
        .navbar-toggler-icon {
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'%3e%3cpath stroke='rgba%28144%2C144%2C168%2C1%29' stroke-linecap='round' stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/%3e%3c/svg%3e") !important;
        }

        /* Mobile collapse */
        @media (max-width: 991px) {
            .navbar-collapse {
                background: rgba(9, 9, 15, 0.98);
                border: 1px solid var(--border-subtle);
                border-radius: 12px;
                padding: 12px;
                margin-top: 8px;
                box-shadow: 0 8px 32px rgba(0,0,0,0.4);
            }
            .nav-link { margin: 2px 0 !important; }
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           MAIN CONTAINER
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .main-container {
            background: transparent;
            border-radius: 0;
            padding: 1.75rem 1.5rem;
            margin: 0 auto;
            max-width: 1400px;
            box-shadow: none;
            animation: fadeInUp 0.4s cubic-bezier(0.16, 1, 0.3, 1) both;
        }

        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(16px); }
            to   { opacity: 1; transform: translateY(0); }
        }

        @keyframes slideInDown {
            from { opacity: 0; transform: translateY(-12px); }
            to   { opacity: 1; transform: translateY(0); }
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           CARDS
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .card {
            background: var(--bg-surface) !important;
            border: 1px solid var(--border-subtle) !important;
            border-radius: 14px !important;
            box-shadow: 0 2px 16px rgba(0,0,0,0.3) !important;
            color: var(--text-primary) !important;
            transition: border-color 0.2s ease, box-shadow 0.2s ease !important;
            overflow: hidden;
            margin-bottom: 1.25rem;
        }

        .card:hover {
            border-color: var(--border-mid) !important;
            box-shadow: 0 4px 24px rgba(0,0,0,0.4) !important;
            transform: none !important; /* remove card bounce */
        }

        .card-header {
            background: var(--bg-elevated) !important;
            border-bottom: 1px solid var(--border-subtle) !important;
            color: var(--text-primary) !important;
            font-weight: 600 !important;
            padding: 14px 20px !important;
        }

        /* Dark card variants used in best_bets */
        .card.bg-dark,
        .card-header.bg-dark {
            background: var(--bg-elevated) !important;
            border-bottom-color: var(--border-mid) !important;
        }

        .card-body {
            background: transparent !important;
            color: var(--text-primary) !important;
        }

        /* Coloured stat cards (bg-primary, bg-success etc) */
        .card.bg-primary  { background: linear-gradient(135deg, #3b4fd8, #5b35a0) !important; border-color: rgba(102,126,234,0.3) !important; }
        .card.bg-info     { background: linear-gradient(135deg, #0e6eb8, #1490d4) !important; border-color: rgba(59,130,246,0.3) !important; }
        .card.bg-success  { background: linear-gradient(135deg, #065f46, #059669) !important; border-color: rgba(16,185,129,0.3) !important; }
        .card.bg-warning  { background: linear-gradient(135deg, #92400e, #d97706) !important; border-color: rgba(245,158,11,0.3) !important; }
        .card.bg-danger   { background: linear-gradient(135deg, #7f1d1d, #dc2626) !important; border-color: rgba(239,68,68,0.3) !important; }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           STAT CARDS (custom class from original)
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .stat-card {
            background: var(--bg-surface) !important;
            border-radius: 14px !important;
            padding: 1.25rem !important;
            box-shadow: var(--card-shadow) !important;
            border-left: 3px solid !important;
            transition: border-color 0.2s, box-shadow 0.2s !important;
            color: var(--text-primary) !important;
        }
        .stat-card:hover {
            transform: none !important;
            box-shadow: 0 4px 24px rgba(0,0,0,0.4) !important;
        }
        .stat-card.primary { border-left-color: var(--accent) !important; }
        .stat-card.success { border-left-color: var(--success) !important; }
        .stat-card.warning { border-left-color: var(--warning) !important; }
        .stat-card.danger  { border-left-color: var(--danger) !important; }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           BUTTONS
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .btn {
            font-family: 'Outfit', sans-serif;
            font-size: 13px !important;
            font-weight: 600 !important;
            border-radius: 8px !important;
            padding: 8px 18px !important;
            border: none !important;
            transition: opacity 0.15s ease, transform 0.15s ease, box-shadow 0.15s ease !important;
            letter-spacing: 0.02em;
        }

        .btn:hover {
            transform: translateY(-1px) !important;
            box-shadow: 0 4px 16px rgba(0,0,0,0.3) !important;
        }

        .btn:active { transform: translateY(0) !important; }

        .btn-primary {
            background: linear-gradient(135deg, var(--accent), var(--accent-2)) !important;
            color: #fff !important;
            box-shadow: 0 2px 10px var(--accent-glow) !important;
        }

        .btn-secondary {
            background: var(--bg-elevated) !important;
            color: var(--text-secondary) !important;
            border: 1px solid var(--border-mid) !important;
        }
        .btn-secondary:hover { color: var(--text-primary) !important; }

        .btn-success {
            background: linear-gradient(135deg, #065f46, #10b981) !important;
            color: #fff !important;
        }

        .btn-danger {
            background: linear-gradient(135deg, #7f1d1d, #ef4444) !important;
            color: #fff !important;
        }

        .btn-info {
            background: linear-gradient(135deg, #1e40af, #3b82f6) !important;
            color: #fff !important;
        }

        .btn-warning {
            background: linear-gradient(135deg, #92400e, #f59e0b) !important;
            color: #fff !important;
        }

        .btn-outline-info {
            background: transparent !important;
            color: var(--info) !important;
            border: 1px solid var(--info) !important;
        }
        .btn-outline-info:hover {
            background: rgba(59,130,246,0.12) !important;
        }

        .btn-lg { padding: 12px 28px !important; font-size: 14px !important; }
        .btn-sm { padding: 5px 12px !important; font-size: 12px !important; }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           FORMS
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .form-control,
        .form-select {
            background: var(--bg-elevated) !important;
            border: 1px solid var(--border-mid) !important;
            border-radius: 8px !important;
            color: var(--text-primary) !important;
            padding: 9px 14px !important;
            font-family: 'Outfit', sans-serif;
            font-size: 14px !important;
            transition: border-color 0.2s, box-shadow 0.2s !important;
        }

        .form-control::placeholder { color: var(--text-muted) !important; }

        .form-control:focus,
        .form-select:focus {
            background: var(--bg-elevated) !important;
            border-color: var(--accent) !important;
            color: var(--text-primary) !important;
            box-shadow: 0 0 0 3px var(--accent-glow) !important;
        }

        /* Select arrow colour fix for dark bg */
        .form-select {
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'%3e%3cpath fill='none' stroke='%239090a8' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M2 5l6 6 6-6'/%3e%3c/svg%3e") !important;
            background-repeat: no-repeat !important;
            background-position: right 12px center !important;
            background-size: 14px !important;
        }

        /* Form labels */
        label { color: var(--text-secondary) !important; font-size: 13px; font-weight: 500; }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           TABLES
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .table {
            color: var(--text-primary) !important;
            border-color: var(--border-subtle) !important;
        }

        .table thead th {
            background: var(--bg-elevated) !important;
            color: var(--text-secondary) !important;
            font-size: 11px !important;
            font-weight: 700 !important;
            letter-spacing: 0.08em !important;
            text-transform: uppercase !important;
            border-bottom: 1px solid var(--border-mid) !important;
            padding: 12px 16px !important;
        }

        .table tbody tr {
            border-color: var(--border-subtle) !important;
            transition: background 0.15s ease !important;
        }

        .table tbody tr:hover {
            background: var(--bg-hover) !important;
            transform: none !important; /* remove scale from original */
        }

        .table tbody td {
            border-color: var(--border-subtle) !important;
            padding: 11px 16px !important;
            vertical-align: middle;
        }

        /* table-hover override */
        .table-hover > tbody > tr:hover > * {
            color: var(--text-primary) !important;
            background-color: var(--bg-hover) !important;
        }

        /* Striped rows */
        .table-striped > tbody > tr:nth-of-type(odd) > * {
            background-color: rgba(255,255,255,0.02) !important;
            color: var(--text-primary) !important;
        }

        /* Row background overrides used in view_meeting */
        tr[style*="background-color: #d4edda"] { background-color: rgba(16,185,129,0.12) !important; }
        tr[style*="background-color: #fff3cd"] { background-color: rgba(245,158,11,0.10) !important; }
        tr[style*="background-color: #ffe4b3"] { background-color: rgba(245,158,11,0.07) !important; }
        tr[style*="background-color: #f8f9fa"] { background-color: rgba(255,255,255,0.02) !important; }
        tr[style*="background-color: #ffffff"]  { background-color: transparent !important; }
        tr[style*="background-color: #e9ecef"]  { background-color: rgba(255,255,255,0.04) !important; }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           BADGES
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .badge {
            font-family: 'DM Mono', monospace !important;
            font-size: 11px !important;
            font-weight: 500 !important;
            padding: 4px 10px !important;
            border-radius: 6px !important;
        }

        .badge.bg-primary,
        .badge.badge-primary   { background: linear-gradient(135deg, var(--accent), var(--accent-2)) !important; }
        .badge.bg-success,
        .badge.badge-success   { background: rgba(16,185,129,0.2) !important; color: #34d399 !important; border: 1px solid rgba(16,185,129,0.3) !important; }
        .badge.bg-warning,
        .badge.badge-warning   { background: rgba(245,158,11,0.2) !important; color: #fbbf24 !important; border: 1px solid rgba(245,158,11,0.3) !important; }
        .badge.bg-danger,
        .badge.badge-danger    { background: rgba(239,68,68,0.2) !important; color: #f87171 !important; border: 1px solid rgba(239,68,68,0.3) !important; }
        .badge.bg-info         { background: rgba(59,130,246,0.2) !important; color: #60a5fa !important; border: 1px solid rgba(59,130,246,0.3) !important; }
        .badge.bg-secondary,
        .badge.badge-secondary { background: var(--bg-hover) !important; color: var(--text-secondary) !important; }
        .badge.badge-light     { background: var(--bg-elevated) !important; color: var(--text-primary) !important; }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           ALERTS
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .alert {
            border-radius: 10px !important;
            border: 1px solid !important;
            padding: 14px 18px !important;
            font-size: 14px !important;
            animation: slideInDown 0.4s cubic-bezier(0.16, 1, 0.3, 1) both !important;
        }

        .alert-success {
            background: rgba(16,185,129,0.10) !important;
            border-color: rgba(16,185,129,0.25) !important;
            color: #34d399 !important;
        }
        .alert-danger {
            background: rgba(239,68,68,0.10) !important;
            border-color: rgba(239,68,68,0.25) !important;
            color: #f87171 !important;
        }
        .alert-warning {
            background: rgba(245,158,11,0.10) !important;
            border-color: rgba(245,158,11,0.25) !important;
            color: #fbbf24 !important;
        }
        .alert-info {
            background: rgba(59,130,246,0.10) !important;
            border-color: rgba(59,130,246,0.25) !important;
            color: #60a5fa !important;
        }

        .btn-close {
            filter: invert(1) opacity(0.5) !important;
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           TYPOGRAPHY HELPERS
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        h1, h2, h3, h4, h5, h6 {
            color: var(--text-primary);
            font-family: 'Outfit', sans-serif;
            font-weight: 700;
            letter-spacing: -0.01em;
        }

        .text-muted { color: var(--text-muted) !important; }
        .text-white { color: var(--text-primary) !important; }

        p { color: var(--text-secondary); }

        a { color: var(--accent); }
        a:hover { color: #8ba4f5; }

        /* Inline style colour overrides used in templates */
        [style*="color: #6c757d"],
        [style*="color:#6c757d"]   { color: var(--text-muted) !important; }
        [style*="color: #667eea"],
        [style*="color:#667eea"]   { color: var(--accent) !important; }
        [style*="color: #28a745"],
        [style*="color:#28a745"]   { color: var(--success) !important; }

        /* Inline background overrides */
        [style*="background: #e8f4f8"],
        [style*="background:#e8f4f8"] {
            background: rgba(59,130,246,0.08) !important;
            border-left-color: var(--accent) !important;
        }
        [style*="background: #fff3cd"],
        [style*="background:#fff3cd"] {
            background: rgba(245,158,11,0.08) !important;
        }
        [style*="background: #d4edda"],
        [style*="background:#d4edda"] {
            background: rgba(16,185,129,0.08) !important;
        }

        /* Inline dark card from view_meeting meeting overview */
        [style*="background: linear-gradient(135deg, #2d2d2d"],
        [style*="background:linear-gradient(135deg,#2d2d2d"] {
            background: linear-gradient(135deg, #0f0f1a 0%, #16162a 100%) !important;
            border: 1px solid var(--border-subtle) !important;
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           LOADING SPINNER
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .spinner {
            width: 36px;
            height: 36px;
            border: 3px solid var(--border-mid);
            border-top-color: var(--accent);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }
        @keyframes spin { to { transform: rotate(360deg); } }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           DETAILS / SUMMARY (view_meeting notes)
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        details summary {
            color: var(--accent) !important;
            cursor: pointer;
            font-size: 12px;
        }
        details pre {
            background: var(--bg-elevated) !important;
            color: var(--text-secondary) !important;
            border: 1px solid var(--border-subtle);
            border-radius: 6px;
            padding: 10px 12px;
            font-size: 11px;
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           MISC UTILITIES
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .border-bottom { border-bottom-color: var(--border-subtle) !important; }
        .border        { border-color: var(--border-subtle) !important; }

        /* List groups used in best_bets */
        .list-unstyled li { color: var(--text-secondary); }

        /* Collapse toggle buttons in best_bets */
        [data-bs-toggle="collapse"] { color: var(--text-secondary) !important; }

        /* Input group */
        .input-group-text {
            background: var(--bg-elevated) !important;
            border: 1px solid var(--border-mid) !important;
            color: var(--text-secondary) !important;
        }

        /* Checkbox */
        input[type="checkbox"] {
            accent-color: var(--accent);
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           RESPONSIVE
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        @media (max-width: 768px) {
            .main-container {
                padding: 1rem 0.875rem;
            }
            body { padding-top: 68px; }
        }

        @media (max-width: 480px) {
            .main-container { padding: 0.75rem; }
        }

    </style>
    {% block extra_css %}{% endblock %}
</head>

<body>
    <!-- â•â•â• NAVIGATION â•â•â• (all links/logic identical to original) -->
    <nav class="navbar navbar-expand-lg fixed-top">
        <div class="container-fluid">
            <a class="navbar-brand" href="{{ url_for('dashboard') }}">
                <img src="{{ url_for('static', filename='apple-touch-icon.png') }}" 
                     alt="The Form Analyst" 
                     style="height: 32px; width: auto;">
            </a>
            <span class="brand-icon">
                    <i class="bi bi-graph-up-arrow"></i>
                </span>
                The Form Analyst
            </a>

            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>

            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto align-items-lg-center">
                    {% if current_user.is_authenticated %}
                        <li class="nav-item">
                            <a class="nav-link {{ 'active' if request.endpoint == 'dashboard' }}" href="{{ url_for('dashboard') }}">
                                <i class="bi bi-speedometer2"></i> Dashboard
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link {{ 'active' if request.endpoint == 'history' }}" href="{{ url_for('history') }}">
                                <i class="bi bi-clock-history"></i> Race Meetings
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link {{ 'active' if request.endpoint in ['results', 'results_entry'] }}" href="{{ url_for('results') }}">
                                <i class="bi bi-check2-square"></i> Results
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link {{ 'active' if request.endpoint == 'data_analytics' }}" href="{{ url_for('data_analytics') }}">
                                <i class="bi bi-bar-chart-line"></i> Data
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link {{ 'active' if request.endpoint == 'best_bets' }}" href="{{ url_for('best_bets') }}">
                                <i class="bi bi-fire"></i> Best Bets
                            </a>
                        </li>
                        {% if current_user.is_admin %}
                        <li class="nav-item">
                            <a class="nav-link {{ 'active' if request.endpoint == 'admin_panel' }}" href="{{ url_for('admin_panel') }}">
                                <i class="bi bi-shield-lock"></i> Admin
                            </a>
                        </li>
                        {% endif %}
                        <li class="nav-item">
                            <span class="nav-link user-pill">
                                <i class="bi bi-person-circle"></i> {{ current_user.username }}
                            </span>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{{ url_for('logout') }}">
                                <i class="bi bi-box-arrow-right"></i> Logout
                            </a>
                        </li>
                    {% else %}
                        <li class="nav-item">
                            <a class="nav-link {{ 'active' if request.endpoint == 'login' }}" href="{{ url_for('login') }}">
                                <i class="bi bi-box-arrow-in-right"></i> Login
                            </a>
                        </li>
                    {% endif %}
                </ul>
            </div>
        </div>
    </nav>

    <!-- â•â•â• MAIN CONTENT â•â•â• -->
    <div class="main-container">

        <!-- Flash Messages (identical logic to original) -->
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
                    <i class="bi bi-{% if category == 'success' %}check-circle{% elif category == 'danger' %}exclamation-triangle{% else %}info-circle{% endif %}"></i>
                    {{ message }}
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
                {% endfor %}
            {% endif %}
        {% endwith %}

        <!-- Page Content -->
        {% block content %}{% endblock %}

    </div>

    <!-- Bootstrap JS (unchanged) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Auto-hide alerts (unchanged) -->
    <script>
        setTimeout(function() {
            let alerts = document.querySelectorAll('.alert');
            alerts.forEach(function(alert) {
                let bsAlert = new bootstrap.Alert(alert);
                bsAlert.close();
            });
        }, 5000);
    </script>

    {% block extra_js %}{% endblock %}

    <!-- â•â•â• CHAT SYSTEM (100% unchanged - logic, endpoints, JS) â•â•â• -->
    {% if current_user.is_authenticated %}
    <!-- Chat Toggle Button -->
    <div id="chat-toggle" title="Ask about racing form">
        <svg width="30" height="30" viewBox="0 0 24 24" fill="white">
            <path d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm0 14H6l-2 2V4h16v12z"/>
        </svg>
    </div>

    <!-- Chat Container -->
    <div id="chatbot-container" class="hidden">
        <div id="chat-header">
            <div>
                <h4>Racing Form Assistant</h4>
                <span id="chat-status">Online</span>
            </div>
            <div id="chat-controls">
                <button id="new-chat-btn" title="New conversation">â†»</button>
                <button id="close-chat-btn" title="Close">Ã—</button>
            </div>
        </div>

        <div id="chat-messages">
            <div class="message assistant welcome-message">
                <p>ğŸ‘‹ G'day! I'm your racing form assistant.</p>
                <p>Ask me about:</p>
                <ul>
                    <li>How to interpret form data</li>
                    <li>Sectional times & track conditions</li>
                    <li>Jockey/trainer statistics</li>
                    <li>Betting strategies</li>
                </ul>
            </div>
        </div>

        <div id="typing-indicator" style="display:none;">
            <span></span><span></span><span></span>
        </div>

        <div id="chat-input-area">
            <input type="text" id="user-input" placeholder="Ask about racing form..." maxlength="500">
            <button id="send-btn">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/>
                </svg>
            </button>
        </div>

        <div id="rate-limit-warning" style="display:none;">
            Rate limit reached. Please wait a moment.
        </div>
    </div>

    <style>
    /* â”€â”€ Chat styles (dark-themed update, all behaviour unchanged) â”€â”€ */
    #chat-toggle {
        position: fixed;
        bottom: 24px;
        right: 24px;
        width: 56px;
        height: 56px;
        border-radius: 50%;
        background: linear-gradient(135deg, var(--accent), var(--accent-2));
        box-shadow: 0 4px 20px var(--accent-glow), 0 2px 8px rgba(0,0,0,0.4);
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: transform 0.2s ease, box-shadow 0.2s ease;
        z-index: 1000;
    }
    #chat-toggle:hover {
        transform: scale(1.08);
        box-shadow: 0 6px 28px rgba(102,126,234,0.5);
    }

    #chatbot-container {
        position: fixed;
        bottom: 24px;
        right: 24px;
        width: 380px;
        height: 500px;
        max-height: calc(100vh - 100px);
        border-radius: 16px;
        background: var(--bg-surface);
        border: 1px solid var(--border-mid);
        box-shadow: 0 16px 48px rgba(0,0,0,0.5);
        display: flex;
        flex-direction: column;
        z-index: 1001;
        transition: all 0.3s ease;
        overflow: hidden;
    }
    #chatbot-container.hidden { display: none; }

    #chat-header {
        padding: 14px 18px;
        background: linear-gradient(135deg, var(--accent), var(--accent-2));
        color: white;
        border-radius: 16px 16px 0 0;
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-shrink: 0;
    }
    #chat-header h4 { margin: 0; font-size: 15px; font-weight: 600; font-family: 'Outfit', sans-serif; }
    #chat-status { font-size: 11px; opacity: 0.85; }

    #chat-controls { display: flex; gap: 8px; }
    #chat-controls button {
        background: rgba(255,255,255,0.15);
        border: none;
        color: white;
        width: 28px;
        height: 28px;
        border-radius: 50%;
        cursor: pointer;
        font-size: 18px;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: background 0.2s;
        line-height: 1;
    }
    #chat-controls button:hover { background: rgba(255,255,255,0.25); }

    #chat-messages {
        flex: 1;
        overflow-y: auto;
        padding: 16px;
        background: var(--bg-base);
        display: flex;
        flex-direction: column;
        gap: 10px;
    }

    .message {
        padding: 10px 14px;
        border-radius: 12px;
        max-width: 85%;
        word-wrap: break-word;
        font-size: 13px;
        line-height: 1.5;
        animation: slideIn 0.25s ease;
    }
    @keyframes slideIn {
        from { opacity: 0; transform: translateY(8px); }
        to   { opacity: 1; transform: translateY(0); }
    }

    .message.user {
        background: linear-gradient(135deg, var(--accent), var(--accent-2));
        color: white;
        margin-left: auto;
        border-bottom-right-radius: 4px;
    }
    .message.assistant {
        background: var(--bg-elevated);
        border: 1px solid var(--border-subtle);
        color: var(--text-primary);
        margin-right: auto;
        border-bottom-left-radius: 4px;
    }
    .message.assistant ul { margin: 6px 0; padding-left: 18px; }
    .message.assistant li { margin: 3px 0; color: var(--text-secondary); }
    .message.error {
        background: rgba(245,158,11,0.10);
        border: 1px solid rgba(245,158,11,0.25);
        color: #fbbf24;
        margin: 0 auto;
        text-align: center;
        font-size: 13px;
    }
    .welcome-message {
        background: rgba(102,126,234,0.08);
        border: 1px solid var(--border-accent);
        max-width: 100%;
        color: var(--text-primary);
    }
    .welcome-message p:first-child { font-weight: 600; margin-bottom: 6px; }

    #typing-indicator {
        padding: 10px 16px;
        background: var(--bg-base);
        flex-shrink: 0;
    }
    #typing-indicator span {
        display: inline-block;
        width: 7px;
        height: 7px;
        border-radius: 50%;
        background: var(--text-muted);
        margin: 0 2px;
        animation: typing 1.4s infinite;
    }
    #typing-indicator span:nth-child(2) { animation-delay: 0.2s; }
    #typing-indicator span:nth-child(3) { animation-delay: 0.4s; }
    @keyframes typing {
        0%, 60%, 100% { transform: translateY(0); opacity: 0.5; }
        30%           { transform: translateY(-8px); opacity: 1; }
    }

    #chat-input-area {
        display: flex;
        padding: 12px 14px;
        border-top: 1px solid var(--border-subtle);
        background: var(--bg-surface);
        border-radius: 0 0 16px 16px;
        gap: 8px;
        flex-shrink: 0;
    }
    #user-input {
        flex: 1;
        padding: 9px 14px;
        background: var(--bg-elevated);
        border: 1px solid var(--border-mid);
        border-radius: 20px;
        font-size: 13px;
        color: var(--text-primary);
        font-family: 'Outfit', sans-serif;
        outline: none;
        transition: border-color 0.2s, box-shadow 0.2s;
    }
    #user-input::placeholder { color: var(--text-muted); }
    #user-input:focus {
        border-color: var(--accent);
        box-shadow: 0 0 0 3px var(--accent-glow);
    }
    #send-btn {
        width: 38px;
        height: 38px;
        border-radius: 50%;
        background: linear-gradient(135deg, var(--accent), var(--accent-2));
        border: none;
        color: white;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: transform 0.15s, box-shadow 0.15s;
        flex-shrink: 0;
        box-shadow: 0 2px 8px var(--accent-glow);
    }
    #send-btn:hover { transform: scale(1.08); }
    #send-btn:active { transform: scale(0.95); }

    #rate-limit-warning {
        background: rgba(245,158,11,0.10);
        color: #fbbf24;
        padding: 8px 14px;
        text-align: center;
        font-size: 12px;
        border-top: 1px solid rgba(245,158,11,0.2);
        flex-shrink: 0;
    }

    /* Chat scrollbar */
    #chat-messages::-webkit-scrollbar { width: 4px; }
    #chat-messages::-webkit-scrollbar-track { background: transparent; }
    #chat-messages::-webkit-scrollbar-thumb { background: var(--border-mid); border-radius: 2px; }

    @media (max-width: 768px) {
        #chatbot-container {
            width: calc(100% - 20px);
            height: calc(100vh - 120px);
            max-height: calc(100vh - 120px);
            bottom: 10px;
            right: 10px;
            border-radius: 14px;
        }
        #chat-toggle { bottom: 16px; right: 16px; width: 52px; height: 52px; }
    }
    </style>

    <script>
    /* â”€â”€ Chat JS: 100% identical logic to original â”€â”€ */
    let chatOpen = false;
    let isTyping = false;

    const chatToggle     = document.getElementById('chat-toggle');
    const chatContainer  = document.getElementById('chatbot-container');
    const closeBtn       = document.getElementById('close-chat-btn');
    const newChatBtn     = document.getElementById('new-chat-btn');
    const sendBtn        = document.getElementById('send-btn');
    const userInput      = document.getElementById('user-input');
    const chatMessages   = document.getElementById('chat-messages');
    const typingIndicator = document.getElementById('typing-indicator');
    const rateLimitWarning = document.getElementById('rate-limit-warning');

    chatToggle.addEventListener('click', toggleChat);
    closeBtn.addEventListener('click', toggleChat);

    function toggleChat() {
        chatOpen = !chatOpen;
        if (chatOpen) {
            chatContainer.classList.remove('hidden');
            chatToggle.style.display = 'none';
            userInput.focus();
            loadChatHistory();
        } else {
            chatContainer.classList.add('hidden');
            chatToggle.style.display = 'flex';
        }
    }

    sendBtn.addEventListener('click', sendMessage);
    userInput.addEventListener('keypress', function(e) {
        if (e.key === 'Enter' && !e.shiftKey) {
            e.preventDefault();
            sendMessage();
        }
    });

    async function sendMessage() {
        const message = userInput.value.trim();
        if (!message || isTyping) return;
        if (message.length > 500) { showError('Message too long (max 500 characters)'); return; }

        addMessageToChat('user', message);
        userInput.value = '';
        isTyping = true;
        typingIndicator.style.display = 'block';
        scrollToBottom();

        try {
            const response = await fetch('/api/chat', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ message: message })
            });
            const data = await response.json();
            typingIndicator.style.display = 'none';
            if (!response.ok) {
                if (response.status === 429) showRateLimitWarning();
                throw new Error(data.error || 'Failed to get response');
            }
            addMessageToChat('assistant', data.response);
        } catch (error) {
            typingIndicator.style.display = 'none';
            addMessageToChat('error', error.message || 'Connection error. Please try again.');
        } finally {
            isTyping = false;
        }
    }

    function addMessageToChat(role, text) {
        const messageDiv = document.createElement('div');
        messageDiv.className = `message ${role}`;
        const formattedText = text
            .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
            .replace(/\n/g, '<br>');
        messageDiv.innerHTML = formattedText;
        if (role === 'user') {
            const welcomeMsg = chatMessages.querySelector('.welcome-message');
            if (welcomeMsg) welcomeMsg.remove();
        }
        chatMessages.appendChild(messageDiv);
        scrollToBottom();
    }

    function scrollToBottom() { chatMessages.scrollTop = chatMessages.scrollHeight; }
    function showError(message) { addMessageToChat('error', message); }
    function showRateLimitWarning() {
        rateLimitWarning.style.display = 'block';
        setTimeout(() => { rateLimitWarning.style.display = 'none'; }, 5000);
    }

    async function loadChatHistory() {
        try {
            const response = await fetch('/api/chat/history');
            const data = await response.json();
            if (data.messages && data.messages.length > 0) {
                chatMessages.innerHTML = '';
                data.messages.forEach(msg => addMessageToChat(msg.role, msg.content));
            }
        } catch (error) { console.error('Failed to load history:', error); }
    }

    newChatBtn.addEventListener('click', async function() {
        if (!confirm('Start a new conversation? Current chat will be saved.')) return;
        try {
            await fetch('/api/chat/new', { method: 'POST' });
            chatMessages.innerHTML = `
                <div class="message assistant welcome-message">
                    <p>ğŸ‘‹ G'day! I'm your racing form assistant.</p>
                    <p>Ask me about:</p>
                    <ul>
                        <li>How to interpret form data</li>
                        <li>Sectional times & track conditions</li>
                        <li>Jockey/trainer statistics</li>
                        <li>Betting strategies</li>
                    </ul>
                </div>`;
        } catch (error) { showError('Failed to start new conversation'); }
    });
    </script>
    {% endif %}
    <!-- CHAT SYSTEM END -->

</body>
</html>
